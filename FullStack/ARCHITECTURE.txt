ARCHITECTURE GUIDELINES

1. MODULAR DESIGN
   - Core Engine (`core/`): Rendering engines (`sprites.py`) and UI system (`ui.py`).
   - Simulation Modules (`simulation/`): Self-contained "Site" files. Each site file
     encapsulates both the specific data structure logic and its corresponding
     Pygame visualization class for improved modularity.
   - Controller (`main.py`): State Machine to switch between Menu and simulation sites.

2. LOGIC LAYER (The Backend)
   - Class: `StackManager` (LIFO) -> Returns `TEMP_POP` / `RESTACK_PUSH` events.
   - Class: `QueueManager` (FIFO) -> Returns `CYCLE` / `DEPART` events.
   - Class: `LinkedListManager` -> Manages `Node` objects with `next` pointers.
   - Class: `BSTManager` -> Manages recursive `BSTNode` structure.
     - Tracks `current_depth` to inform the visualization layer of scaling needs.
   - Responsibility: Pure data manipulation. No Pygame code allowed in these logic classes.

3. VISUALIZATION LAYER (The Frontend)
   - Procedural Generation:
     - Stack/Queue: Textured asphalt, corrugated metal, scattered props.
     - Linked List: Volumetric lighting, animated belts.
     - BST: Dynamic grid lines, hazard stripes, conveyor paths.
   - Smart Layout Engine (BST Specific):
     - Uses a **Recursive 50% Fill Rate** algorithm.
     - Calculates node size based on `(Screen Width / 2^Depth) * 0.5`.
     - This guarantees mathematically that nodes can never overlap, regardless of depth.
     - Implements "Smooth Zoom" using Linear Interpolation (Lerp) for positions.
   - Animation Strategy:
     - Uses **Strict Sequential Processing** and callback-driven event chains.
     - Packages in the BST track *Logical Node Objects* rather than fixed coordinates,
       allowing them to follow the tree even as it resizes/moves during animation.

4. UI & INTERACTION (The Handheld)
   - Style: Rugged Industrial Scanner (Zebra/Honeywell aesthetic).
   - Components: 
     - `HandheldChassis`: Draws the device body with hazard stripes and bolts.
     - `LCDDisplay`: Retro green-screen text input with scanlines.
     - `RoundButton`: Tactile rubber buttons with 3D bevels.